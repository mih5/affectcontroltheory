{
    "contents" : "#---------------------------LOAD PACKAGES-------------------------\nrequire(BMA) #Adrian Raftery's Bayesian Model Averaging Package\nrequire(BAS) #Merlise Clyde's Bayesian Model Averaging Package\nrequire(corrplot) #for plotting corrplots\nrequire(mvtnorm)\nrequire(ggplot2)\nset.seed(10294)\nsetwd(\"C:/Users/Mao/Dropbox/Junior Year/Affect Control Research/csv Data/scripts\")\n\n\n#---------------------------CREATE TRUE MODEL--------------------------\nduke10 <- read.csv(\"C:/Users/Mao/Dropbox/Junior Year/Affect Control Research/csv Data/scripts/duke10_by_event.csv\")\n#What are the characteristics of this dataset?\n\nsummary(duke10$eae)\n\n\n#Here we create a hypothetical \"true\" model for impression change\n\n\nsim.B = c(0.5,0.4,-0.5,0.3,rnorm(24,0,.025),0.35,rnorm(20,0,.025),-0.3,rnorm(14,0,.025))\nwhich(abs(sim.B)>.25)\nhist(sim.B,breaks =20)\nlength(sim.B)\nplot(sim.B)\nqplot(x=1:64,y=sim.B,xlab=\"Index\",ylab=\"Coefficient\",size=5)+theme(text=element_text(size=20),legend.position=\"none\")\n\n\n\nX.mean=matrix(colMeans(duke10[,10:18]))\nX.sd=apply(duke10[,10:18],2,sd)\nY.sd=0.7*sd(duke10[,1])\n\n\n#simulated covariates\nsim.X1= rmvnorm(150,X.mean,diag(X.sd,nrow=9))\n\n#two-way cross-word interactions\nsim.X1.interaction = as.matrix(t(apply(sim.X1,1,combn,2,prod)))\ncolnames(sim.X1.interaction)=paste(combn(names(duke10[,10:18]),2,paste,collapse=\".\"),sep=\"\")\nsim.X1.interaction.2=sim.X1.interaction[,c(-1,-2,-9,-22,-23,-27,-34,-35,-36)]\n\n#three-way interactions, only including cross-word interactions\nsim.X1.3.names.full=paste(combn(names(duke10[,10:18]),3,paste,collapse=\".\"),sep=\"\")\n\n#for-loop looks through all the interactions and stores only those which are cross-word interactions\nsim.X1.3.names=NULL\nfor (i in 1:length(sim.X1.3.names.full)){\n  interaction=sim.X1.3.names.full[i]\n  words = c(substr(interaction,1,1),substr(interaction,4,4),substr(interaction,7,7))\n  if(!is.na(sum(pmatch(c(\"a\",\"b\",\"o\"),words)))){\n    sim.X1.3.names=rbind(sim.X1.3.names,c(interaction,1))\n    print(interaction)\n  }\n  else{\n    sim.X1.3.names=rbind(sim.X1.3.names,c(\"\",0))\n  }\n}\n\nsim.X1.interaction.3 = as.matrix(t(apply(sim.X1,1,combn,3,prod)))[,as.numeric(sim.X1.3.names[,2])]\ncolnames(sim.X1.interaction.3)=sim.X1.3.names[which(sim.X1.3.names[,2]==1),1]\n\n#combine both\nsim.X1.design.matrix = cbind(1,sim.X1,sim.X1.interaction.2,sim.X1.interaction.3)\n\n\n\n#generate Y from normal with sd from lm of actual data\nsim.Y=matrix(rmvnorm(1,sim.X1.design.matrix%*%sim.B,diag(Y.sd,150)),ncol=1)\n\nsd(sim.Y)\nsd(duke10$eae)\n\nsim.data=data.frame(cbind(sim.Y,sim.X1.design.matrix))\nnames(sim.data)[1]=\"eae\"\nnames(sim.data)[2]=\"Intercept\"\nnames(sim.data)[3:11]=names(duke10[10:18])\n\n#naive OLS regression\nsim.model.ols = lm(eae~.,data=sim.data[,-2])\nsummary(sim.model.ols)\nplot(sim.model.ols$coefficients)\n\n\n#stepwise regression\nsim.model.stepwise = step(sim.model.ols)\nsummary(sim.model.stepwise)\n\nnames(sim.data[,-1])[which(abs(sim.B)>.25)]\n\n#bayesian model averaging\nsim.model.BAS = bas.lm(eae~.,data=sim.data[,-2],n.models=10000)\nsummary(sim.model.BAS)\ncoefs.BAS=coef(sim.model.BAS)\nprint(coefs.BAS)\nplot(coefs.BAS$postmean)\nplot(coefs.BAS$probne0)\nnames(sim.data[,-1])[which(coefs.BAS$probne0>.5)]\nwhich(coefs.BAS$probne0>.5)\n\nwhich(sim.model.BAS$which==which(coefs.BAS$probne0>.5))\n\n\ncoefs.BAS$probne0[29]\nqplot(y=coefs.BAS$probne0,x=1:64,xlab=\"index\",ylab=\"Model inclusion probability\",size=5)+theme(text=element_text(size=20),legend.position=\"none\")\n\n\n#maximum a posteriori model\nnames(sim.data[,c(-1,-2)])[sim.model.BAS$which[which(sim.model.BAS$postprob==max(sim.model.BAS$postprob))][[2]]]\n\n#Maximum a posteriori model\ncoefs.BAS$conditionalmeans[which(sim.model.BAS$postprob==max(sim.model.BAS$postprob))[[1]],]\n\n\n##Bayesian Model averaging\nsim.model.BAM = bicreg(sim.data[,-1],sim.data[,1])\nsummary(sim.model.BAM)\n\n##plot coefficient estimates against each other\nsim.model.stepwise.coefficients = sim.model.stepwise$coefficients\n        \nindices.stepwise=pmatch(names(sim.model.stepwise.coefficients),names(sim.data[-1]))\nindices.stepwise.2=c(1,indices.stepwise[-1])\n\nstepwise.coefs=data.frame(coefs=sim.model.stepwise.coefficients,index=indices.stepwise.2,method=\"stepwise\")\nstepwise.coefs\n\nBAS.coefs=data.frame(coefs=coefs.BAS$conditionalmeans[which(sim.model.BAS$postprob==max(sim.model.BAS$postprob))[[1]],],index=1:64,method=\"BMA\")\n#data.frame(coefs=coefs.BAS$postmean,index=1:64,method=\"BMA\")\nBAS.coefs\n\ntrue.coefs = data.frame(coefs=sim.B,index=1:64,method=\"Simulation\")\ntrue.coefs\n\n\ndatastuff = rbind(stepwise.coefs,BAS.coefs,true.coefs)\n\np <- ggplot(data=datastuff, aes(x=index,y=coefs,colour=method,shape=method,size=5))+geom_point()+theme(text=element_text(size=20))\np\n\n# generate new data\n\n#simulated covariates\nsim.X2= rmvnorm(150,X.mean,diag(X.sd,nrow=9))\n\n#two-way cross-word interactions\nsim.X2.interaction = as.matrix(t(apply(sim.X2,1,combn,2,prod)))\ncolnames(sim.X2.interaction)=paste(combn(names(duke10[,10:18]),2,paste,collapse=\".\"),sep=\"\")\nsim.X2.interaction.2=sim.X2.interaction[,c(-1,-2,-9,-22,-23,-27,-34,-35,-36)]\n\n#three-way interactions, only including cross-word interactions\nsim.X2.3.names.full=paste(combn(names(duke10[,10:18]),3,paste,collapse=\".\"),sep=\"\")\n\n#for-loop looks through all the interactions and stores only those which are cross-word interactions\nsim.X2.3.names=NULL\nfor (i in 1:length(sim.X2.3.names.full)){\n  interaction=sim.X2.3.names.full[i]\n  words = c(substr(interaction,1,1),substr(interaction,4,4),substr(interaction,7,7))\n  if(!is.na(sum(pmatch(c(\"a\",\"b\",\"o\"),words)))){\n    sim.X2.3.names=rbind(sim.X2.3.names,c(interaction,1))\n    print(interaction)\n  }\n  else{\n    sim.X2.3.names=rbind(sim.X2.3.names,c(\"\",0))\n  }\n}\n\nsim.X2.interaction.3 = as.matrix(t(apply(sim.X2,1,combn,3,prod)))[,as.numeric(sim.X2.3.names[,2])]\ncolnames(sim.X2.interaction.3)=sim.X2.3.names[which(sim.X2.3.names[,2]==1),1]\n\n#combine both\nsim.X2.design.matrix.matrix = cbind(1,sim.X2,sim.X2.interaction.2,sim.X2.interaction.3)\nsim.X2.design.matrix = data.frame(sim.X2.design.matrix.matrix)\nnames(sim.X2.design.matrix)[1:9] = names(duke10[10:18])\n\n#generate Y from normal with sd from lm of actual data\nsim.Y2=matrix(rmvnorm(1,sim.X2.design.matrix.matrix%*%sim.B,diag(Y.sd,150)),ncol=1)\n\nBAS.predict.1=predict(sim.model.BAS,newdata=sim.X1.design.matrix)$Ybma\nBAS.predict.2=predict(sim.model.BAS,newdata=sim.X2.design.matrix.matrix)$Ybma\n\nstepwise.predict.1=predict(sim.model.stepwise)\nstepwise.predict.2=predict(sim.model.stepwise,newdata=sim.X2.design.matrix)\n\nSS.total.1 = sum((sim.Y-mean(sim.Y))^2)\n\nSS.BAS.1 = sum((sim.Y-BAS.predict.1)^2)\n\nSS.stepwise.1 = sum((sim.Y-stepwise.predict.1)^2)\n\nBAS.rsquared.1 = 1- SS.BAS.1/SS.total.1\nBAS.rsquared.1\n\nstepwise.rsquared.1 = 1 - SS.stepwise.1/SS.total.1\nstepwise.rsquared.1\n\nmean((BAS.predict.2-sim.Y2)^2)\nmean((stepwise.predict.2-sim.Y2)^2)\nmean((sim.Y2-mean(sim.Y2))^2)\n\n\n",
    "created" : 1409063615736.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2265341312",
    "id" : "B9A5D5A9",
    "lastKnownWriteTime" : 1409073395,
    "path" : "C:/Users/Mao/Dropbox/Junior Year/Affect Control Research/csv Data/scripts/simulation3.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}